// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`parses log data with multiple requests 1`] = `
Object {
  "0": Object {
    "@timestamp": "2019-02-26T16:48:37.234Z",
    "api_stage": "uwe3g5jm54/Prod",
    "endpoint_request_body": Object {},
    "endpoint_request_uri": "https://lambda.eu-west-2.amazonaws.com/2015-03-31/functions/arn:aws:lambda:eu-west-2:958845080241:function:log-test-1-StartReceiptVerifyFunc-BEGOSV0XJRHI/invocations",
    "endpoint_response_body": Object {
      "body": Object {
        "message": "Request failed with status code 502

\\"Error: Request failed with status code 502\\\\n at createError (/var/task/node_modules/axios/lib/core/createError.js:16:15)\\\\n at settle (/var/task/node_modules/axios/lib/core/settle.js:18:12)\\\\n at IncomingMessage.handleStreamEnd (/var/task/node_modules/axios/lib/adapters/http.js:201:11)\\\\n at emitNone (events.js:111:20)\\\\n at IncomingMessage.emit (events.js:208:7)\\\\n at endReadableNT (_stream_readable.js:1064:12)\\\\n at /opt/nodejs/node_modules/async-listener/glue.js:188:31\\\\n at _combinedTickCallback (internal/process/next_tick.js:138:11)\\\\n at process._tickDomainCallback [as _tickCallback] (internal/process/next_tick.js:218:9)\\"",
      },
      "statusCode": 500,
    },
    "endpoint_response_headers": Object {
      "Connection": "keep-alive",
      "Content-Length": "745",
      "Content-Type": "application/json",
      "Date": "Tue",
      "X-Amz-Executed-Version": "$LATEST",
      "X-Amzn-Trace-Id": "root",
      "x-amzn-Remapped-Content-Length": "0",
      "x-amzn-RequestId": "15aba189-6719-4153-b214-46824db50ffa",
    },
    "execution_failure": "Malformed Lambda proxy response",
    "http_method": "POST",
    "http_resource_path": "/receipt",
    "integration_latency": 111,
    "method_request_body": Object {},
    "method_request_headers": Object {
      "Accept": "application/json",
      "Accept-Encoding": "gzip",
      "CloudFront-Forwarded-Proto": "https",
      "CloudFront-Is-Desktop-Viewer": "true",
      "CloudFront-Is-Mobile-Viewer": "false",
      "CloudFront-Is-SmartTV-Viewer": "false",
      "CloudFront-Is-Tablet-Viewer": "false",
      "CloudFront-Viewer-Country": "GB",
      "Content-Type": "application/json",
      "Host": "uwe3g5jm54.execute-api.eu-west-2.amazonaws.com",
      "User-Agent": "python-requests/2.20.0",
      "Via": "1.1 e2ba00588275e7b45594ad99994de543.cloudfront.net (CloudFront)",
      "X-Amz-Cf-Id": "KCem6vn221G2u9mfQEK0US4aO2sYkdTS5Sm7Hlkcdx26tmXDBTaOnA",
      "X-Amzn-Trace-Id": "Root",
      "X-Forwarded-For": "62.254.81.74",
      "X-Forwarded-Port": "443",
      "X-Forwarded-Proto": "https",
    },
    "method_status": 502,
    "request-end-time": 2019-02-26T16:48:37.349Z,
    "request-execution-duration": 115,
    "request-start-time": 2019-02-26T16:48:37.234Z,
    "request_id": "5cb7ee58-39e6-11e9-be7e-29aff96747f2",
    "request_path": "{}",
    "request_query_string": Object {},
  },
  "1": Object {
    "@timestamp": "2019-02-26T16:48:42.879Z",
    "api_stage": "uwe3g5jm54/Prod",
    "endpoint_request_body": Object {},
    "endpoint_request_uri": "https://lambda.eu-west-2.amazonaws.com/2015-03-31/functions/arn:aws:lambda:eu-west-2:958845080241:function:log-test-1-StartReceiptVerifyFunc-BEGOSV0XJRHI/invocations",
    "endpoint_response_body": Object {
      "body": "{\\"subscriptionId\\":\\"5bc5e2c7-c33e-5bf7-87cf-8753c59fef95\\"}",
      "statusCode": 200,
    },
    "endpoint_response_headers": Object {
      "Connection": "keep-alive",
      "Content-Length": "89",
      "Content-Type": "application/json",
      "Date": "Tue",
      "X-Amz-Executed-Version": "$LATEST",
      "X-Amzn-Trace-Id": "root",
      "x-amzn-Remapped-Content-Length": "0",
      "x-amzn-RequestId": "5bebd615-2628-4e51-b176-d9522190c6f6",
    },
    "http_method": "POST",
    "http_resource_path": "/receipt",
    "integration_latency": 123,
    "method_request_body": Object {},
    "method_request_headers": Object {
      "Accept": "application/json",
      "Accept-Encoding": "gzip",
      "CloudFront-Forwarded-Proto": "https",
      "CloudFront-Is-Desktop-Viewer": "true",
      "CloudFront-Is-Mobile-Viewer": "false",
      "CloudFront-Is-SmartTV-Viewer": "false",
      "CloudFront-Is-Tablet-Viewer": "false",
      "CloudFront-Viewer-Country": "GB",
      "Content-Type": "application/json",
      "Host": "uwe3g5jm54.execute-api.eu-west-2.amazonaws.com",
      "User-Agent": "python-requests/2.20.0",
      "Via": "1.1 e874817f6498def18bc3c2de8e842383.cloudfront.net (CloudFront)",
      "X-Amz-Cf-Id": "vUztExf9G4abZd6OTnIaYjE2wmI3dXqp_c2WZtYUTaq0ZiK0VpjOjw",
      "X-Amzn-Trace-Id": "Root",
      "X-Forwarded-For": "62.254.81.74",
      "X-Forwarded-Port": "443",
      "X-Forwarded-Proto": "https",
    },
    "method_response_body": Object {
      "subscriptionId": "5bc5e2c7-c33e-5bf7-87cf-8753c59fef95",
    },
    "method_response_headers": Object {
      "X-Amzn-Trace-Id": "Root",
    },
    "method_status": 200,
    "request-end-time": 2019-02-26T16:48:43.004Z,
    "request-execution-duration": 125,
    "request-start-time": 2019-02-26T16:48:42.879Z,
    "request_id": "6015718a-39e6-11e9-be7e-29aff96747f2",
    "request_path": "{}",
    "request_query_string": Object {},
  },
  "2": Object {
    "@timestamp": "2019-02-26T16:48:43.855Z",
    "api_stage": "uwe3g5jm54/Prod",
    "endpoint_request_body": Object {},
    "endpoint_request_uri": "https://lambda.eu-west-2.amazonaws.com/2015-03-31/functions/arn:aws:lambda:eu-west-2:958845080241:function:log-test-1-EchoPostFunction-9TJON2VOEHC0/invocations",
    "endpoint_response_body": Object {
      "body": "{\\"body\\":{\\"id\\":\\"2a7fd6fe-45ae-4255-95b5-9e9339d5d321\\"}}",
      "statusCode": 200,
    },
    "endpoint_response_headers": Object {
      "Connection": "keep-alive",
      "Content-Length": "88",
      "Content-Type": "application/json",
      "Date": "Tue",
      "X-Amz-Executed-Version": "$LATEST",
      "X-Amzn-Trace-Id": "root",
      "x-amzn-Remapped-Content-Length": "0",
      "x-amzn-RequestId": "b3ebd3c9-1045-4001-ae58-fb611115ec9b",
    },
    "http_method": "POST",
    "http_resource_path": "/echo",
    "integration_latency": 11,
    "method_request_body": Object {},
    "method_request_headers": Object {
      "Accept": "application/json",
      "Accept-Encoding": "gzip",
      "CloudFront-Forwarded-Proto": "https",
      "CloudFront-Is-Desktop-Viewer": "true",
      "CloudFront-Is-Mobile-Viewer": "false",
      "CloudFront-Is-SmartTV-Viewer": "false",
      "CloudFront-Is-Tablet-Viewer": "false",
      "CloudFront-Viewer-Country": "GB",
      "Content-Type": "application/json",
      "Host": "uwe3g5jm54.execute-api.eu-west-2.amazonaws.com",
      "User-Agent": "python-requests/2.20.0",
      "Via": "1.1 6b11bd43fbd97ec7bb8917017ae0f954.cloudfront.net (CloudFront)",
      "X-Amz-Cf-Id": "_cR9ADd_XKDi544atuG_2YYYzBIWRYBC85bsER8GoVnBVV7ooeEGaA",
      "X-Amzn-Trace-Id": "Root",
      "X-Forwarded-For": "62.254.81.74",
      "X-Forwarded-Port": "443",
      "X-Forwarded-Proto": "https",
    },
    "method_response_body": Object {
      "body": Object {
        "id": "2a7fd6fe-45ae-4255-95b5-9e9339d5d321",
      },
    },
    "method_response_headers": Object {
      "X-Amzn-Trace-Id": "Root",
    },
    "method_status": 200,
    "request-end-time": 2019-02-26T16:48:43.869Z,
    "request-execution-duration": 14,
    "request-start-time": 2019-02-26T16:48:43.855Z,
    "request_id": "60aa5e11-39e6-11e9-be7e-29aff96747f2",
    "request_path": "{}",
    "request_query_string": Object {},
  },
  "3": Object {
    "@timestamp": "2019-02-26T16:48:45.256Z",
    "api_stage": "uwe3g5jm54/Prod",
    "endpoint_request_body": Object {},
    "endpoint_request_uri": "https://lambda.eu-west-2.amazonaws.com/2015-03-31/functions/arn:aws:lambda:eu-west-2:958845080241:function:log-test-1-StartReceiptVerifyFunc-BEGOSV0XJRHI/invocations",
    "endpoint_response_body": Object {
      "body": "{\\"subscriptionId\\":\\"5bc5e2c7-c33e-5bf7-87cf-8753c59fef95\\"}",
      "statusCode": 200,
    },
    "endpoint_response_headers": Object {
      "Connection": "keep-alive",
      "Content-Length": "89",
      "Content-Type": "application/json",
      "Date": "Tue",
      "X-Amz-Executed-Version": "$LATEST",
      "X-Amzn-Trace-Id": "root",
      "x-amzn-Remapped-Content-Length": "0",
      "x-amzn-RequestId": "54030987-ce05-4f2e-ac9d-7ad4b5cee7ba",
    },
    "http_method": "POST",
    "http_resource_path": "/receipt",
    "integration_latency": 185,
    "method_request_body": Object {},
    "method_request_headers": Object {
      "Accept": "application/json",
      "Accept-Encoding": "gzip",
      "CloudFront-Forwarded-Proto": "https",
      "CloudFront-Is-Desktop-Viewer": "true",
      "CloudFront-Is-Mobile-Viewer": "false",
      "CloudFront-Is-SmartTV-Viewer": "false",
      "CloudFront-Is-Tablet-Viewer": "false",
      "CloudFront-Viewer-Country": "GB",
      "Content-Type": "application/json",
      "Host": "uwe3g5jm54.execute-api.eu-west-2.amazonaws.com",
      "User-Agent": "python-requests/2.20.0",
      "Via": "1.1 e07a8966bd7e1454b7e4fbbface731a2.cloudfront.net (CloudFront)",
      "X-Amz-Cf-Id": "mGmJz7sqdXXslLx6f-L_KQuS_Zpu7OCWoOsvWq4XBlSjNLU6h_ctZA",
      "X-Amzn-Trace-Id": "Root",
      "X-Forwarded-For": "62.254.81.74",
      "X-Forwarded-Port": "443",
      "X-Forwarded-Proto": "https",
    },
    "method_response_body": Object {
      "subscriptionId": "5bc5e2c7-c33e-5bf7-87cf-8753c59fef95",
    },
    "method_response_headers": Object {
      "X-Amzn-Trace-Id": "Root",
    },
    "method_status": 200,
    "request-end-time": 2019-02-26T16:48:45.444Z,
    "request-execution-duration": 188,
    "request-start-time": 2019-02-26T16:48:45.256Z,
    "request_id": "617ffe5e-39e6-11e9-be7e-29aff96747f2",
    "request_path": "{}",
    "request_query_string": Object {},
  },
}
`;

exports[`parses log events 1`] = `
Object {
  "0": Object {
    "@timestamp": "2019-02-26T15:29:33.732Z",
    "api_stage": "h733q2j6gb/Prod",
    "endpoint_request_body": Object {
      "*/*\\",\\"Content-Type\\":\\"application/json;charset": Array [
        "utf-8\\"",
        "\\"Debug-Log-Enabled\\":\\"false\\"",
        "\\"Host\\":\\"h733q2j6gb.execute-api.eu-west-2.amazonaws.com\\"",
        "\\"User-Agent\\":\\"python-requests/2.20.0\\"",
        "\\"X-Amzn-Trace-Id\\":\\"Self",
      ],
      "*/*\\"],\\"Content-Type\\":[\\"application/json;charset": Array [
        "utf-8\\"]",
        "\\"Debug-Log-Enabled\\":[\\"false\\"]",
        "\\"Host\\":[\\"h733q2j6gb.execute-api.eu-west-2.amazonaws.com\\"]",
        "\\"User-Agent\\":[\\"python-requests/2.20.0\\"]",
        "\\"X-Amzn-Trace-Id\\":[\\"Self",
      ],
    },
    "endpoint_request_uri": "https://lambda.eu-west-2.amazonaws.com/2015-03-31/functions/arn:aws:lambda:eu-west-2:958845080241:function:mock-receipt-api-2-25-VerifyReceiptFunction-8K5LT90CVKH6/invocations",
    "endpoint_response_body": Object {
      "truncated": true,
    },
    "endpoint_response_headers": Object {
      "Connection": "keep-alive",
      "Content-Length": "1136",
      "Content-Type": "application/json",
      "Date": "Tue",
      "X-Amz-Executed-Version": "$LATEST",
      "X-Amzn-Trace-Id": "root",
      "x-amzn-Remapped-Content-Length": "0",
      "x-amzn-RequestId": "57593f79-6e46-4a6f-91b1-f5d848cc2059",
    },
    "http_method": "POST",
    "http_resource_path": "/verifyReceipt",
    "integration_latency": 40,
    "method_request_body": Object {},
    "method_request_headers": Object {
      "Accept": "application/json",
      "Content-Type": "application/json;charset",
      "Debug-Log-Enabled": "false",
      "Host": "h733q2j6gb.execute-api.eu-west-2.amazonaws.com",
      "User-Agent": "python-requests/2.20.0",
      "X-Amzn-Trace-Id": "Self",
      "X-Forwarded-For": "18.130.162.42",
      "X-Forwarded-Port": "443",
      "X-Forwarded-Proto": "https",
      "x-correlation-id": "f82097ed-5302-4a98-8200-dad186b419be",
      "x-correlation-span-id": "LUUMyTw58JG0vhnGfa",
    },
    "method_response_body": Object {
      "truncated": true,
    },
    "method_response_headers": Object {
      "X-Amzn-Trace-Id": "Root",
    },
    "method_status": 200,
    "request-end-time": 2019-02-26T15:29:33.774Z,
    "request-execution-duration": 42,
    "request-start-time": 2019-02-26T15:29:33.732Z,
    "request_id": "515f1e99-39db-11e9-9e96-01e5c04505b9",
    "request_path": "{}",
    "request_query_string": Object {},
  },
}
`;

exports[`parsing log events that is a key throttle log returns the correct results 1`] = `
Object {
  "0": Object {
    "@timestamp": "2019-02-26T15:29:30.161Z",
    "api_stage": "uwe3g5jm54/Prod",
    "key_throttle": Object {
      "burst": 1,
      "http_method": "POST",
      "limit": 1,
      "resource": "k0w8mc",
    },
    "method_status": 429,
    "request-end-time": 2019-02-26T15:29:30.162Z,
    "request-execution-duration": 1,
    "request-start-time": 2019-02-26T15:29:30.161Z,
    "request_id": "4f3e3b0f-39db-11e9-9c2e-5bd7c2de5998",
  },
}
`;
